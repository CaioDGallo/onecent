# PostgreSQL Configuration for 230MB Memory Limit
# Optimized for containerized deployment with increased memory

# Memory Settings (Optimized for 230MB limit)
shared_buffers = 42MB                    # ~18% of RAM (reduced to prevent OOM)
work_mem = 256kB                        # Conservative per-connection (250 * 256kB = 62.5MB max)
maintenance_work_mem = 8MB              # Reduced maintenance memory
effective_cache_size = 140MB            # OS cache assumption

# Connection Settings
listen_addresses = '*'                  # Accept connections from all interfaces
port = 5432                            # Default PostgreSQL port
max_connections = 250                    # Memory-constrained limit
superuser_reserved_connections = 2

# WAL Configuration (Optimized for high RPS workload)
wal_level = replica                     # Enable replication
max_wal_size = 128MB                    # Increased for RPS spikes
min_wal_size = 64MB                     # Higher minimum to reduce cycling
wal_compression = on                    # Compress WAL records
checkpoint_timeout = 5min               # Less frequent checkpoints (default)
checkpoint_completion_target = 0.7      # Faster checkpoint completion

# Performance for Limited Resources
synchronous_commit = off                # Async commits for better throughput
commit_delay = 10000                    # Microseconds - batch commits
random_page_cost = 1.1                  # Assume SSD storage
effective_io_concurrency = 200          # SSD optimization

# Logging (Minimal for performance)
log_statement = 'none'
log_min_duration_statement = 1000       # Only log slow queries
logging_collector = off

# Background Writer
bgwriter_delay = 200ms                  # Write dirty pages more often
bgwriter_lru_maxpages = 100            # Conservative
